# モック運用→実機運用の切り替え手順

## 目的
- モック運用から実機運用に切り替え、実APIの検証まで迷わず進める

## 前提
- Supabaseプロジェクトが作成済み
- Google/MetaのOAuth設定が完了している
- システム管理者でログインできる

## 手順（クリック単位）
1. `.env.local` を開き、以下を設定する
   - `PROVIDER_MOCK_MODE=false`
   - 実機運用で必須の環境変数（診断画面の「実機運用で必須」欄）
2. `pnpm dev` を再起動する
3. `/admin/diagnostics` を開く
   - 「モック運用: OFF」「外部API呼び出し: 有効」になっていることを確認
   - 実機運用の必須環境変数が「設定済み」になっていることを確認
4. `/app/locations` を開き、Google/Meta を再接続する
   - 既に接続済みでも、権限不足が疑われる場合は再接続
5. `/admin/provider-health` を開く
   - 「チェック実行」を押して結果を確認する
6. `/app/locations/[id]` で投稿/レビューの動作確認を行う

## /app/setup の使い方
- `/app/setup` で進捗とKPIを確認する
- 「完了にする」チェックは owner/admin のみ保存可能
- 保存できない場合は理由が表示される（Supabase未設定や権限不足など）

## よくある詰まりと対処
- **再認可が必要**: 接続済みでも期限切れの可能性。再接続を実施する。
- **権限不足**: GoogleはAPI承認、MetaはApp Reviewとページ権限を確認する。
- **環境変数未設定**: 診断画面の「実機運用で必須」を埋める。
- **実機ヘルスチェックが未実行**: `/admin/provider-health` で再確認する。

## 注意
- トークン/シークレットは画面・監査ログ・共有メモに貼らない
- 署名URLの完全値を共有しない（短命だが漏洩リスクがある）
