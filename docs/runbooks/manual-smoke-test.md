# 手動スモークテスト（実画面）

## 目的
- ローカル環境で「ログイン → ロケーション作成 → Google接続/切断」までを最短で確認する

## 事前準備
- `.env.local` が作成済み（`README.md` の環境変数表を参照）
- SupabaseのSQL適用とシード実行が完了している
- `pnpm dev` が起動できる状態

## 手順（クリック単位）

### 1) アプリ起動
```bash
pnpm dev
```
- ブラウザで `http://localhost:3000` を開く

### 2) ログイン
1. `/auth/sign-in` を開く
2. `SYSTEM_ADMIN_EMAIL` とパスワードを入力
3. 「サインイン」をクリック
4. `/app` に遷移することを確認

### 3) ロケーション作成
1. `/app/locations` を開く
2. 「新規作成」をクリック
3. 必須項目を入力（名前は必須、住所/緯度/経度は任意）
4. 「作成」をクリック
5. 自動で `/app/locations/<id>` に遷移することを確認

### 4) Google接続
1. ロケーション詳細の「Google」セクションを確認
2. 「接続開始」をクリック
3. Google同意画面で対象アカウントを選択
4. 許可後に戻り、状態が「接続済み」になることを確認
5. 「API承認が必要」と表示される場合は、API承認が未完了

### 5) Google切断
1. 「切断」をクリック
2. 状態が「未接続」に戻ることを確認

## 失敗時の切り分け表

| 症状 | 可能性 | 対処 |
| --- | --- | --- |
| ログインできない | シード未実行 / Supabaseキー不足 | `pnpm seed` を再実行。`.env.local` のSupabaseキーを再確認 |
| ロケーション作成が失敗する | 権限不足 / RLS未設定 | 管理ユーザーでログイン。RLSとシードの完了を確認 |
| Google接続で失敗する | `GOOGLE_CLIENT_ID` など未設定 | `.env.local` の必須値を確認 |
| `redirect_uri_mismatch` | リダイレクトURI不一致 | Google側の設定と `GOOGLE_REDIRECT_URI` を一致させる |
| `invalid_grant` | 期限切れ/再認可不足 | もう一度「接続開始」を実行 |
| `state` 不一致 | 途中でタブを閉じた/再読み込み | もう一度「接続開始」を実行 |
| 再認可が必要 | refreshが無い/失効 | もう一度「接続開始」を実行 |
