# 管理者ユーザー管理（追加/変更/削除）

## 目的
- システム管理者がユーザーと組織メンバーを安全に運用できるようにする
- 失敗時の切り分けを明確にする

## 前提
- system_admin 権限のユーザーでログインしている
- `SUPABASE_SERVICE_ROLE_KEY` が設定済み
- 招待メール方式はSMTP設定が必要（未設定なら仮パスワード方式を使う）

## ユーザー作成（招待メール）
1) `/admin/users` を開く  
2) **メールアドレス** を入力  
3) **作成方式** を「招待メール」に選択  
4) **ユーザーを作成** をクリック  
5) 画面に「招待メールを送信しました。」が表示される  

## ユーザー作成（仮パスワード）
1) `/admin/users` を開く  
2) **メールアドレス** を入力  
3) **作成方式** を「仮パスワード」に選択  
4) **ユーザーを作成** をクリック  
5) 「仮パスワード（この画面でのみ表示）」が表示される  
6) パスワードを安全な手段で本人に共有し、初回ログイン後に変更するよう案内する  

## 組織にメンバー追加
1) `/admin/organizations` を開く  
2) 対象組織の **詳細へ** をクリック  
3) **メンバー追加** にメールとロールを入力  
4) **メンバーを追加** をクリック  

## ロール変更
1) `/admin/organizations/<id>` を開く  
2) 対象メンバーの **ロール変更** で新しいロールを選択  
3) **変更** をクリック  

## メンバー削除
1) `/admin/organizations/<id>` を開く  
2) 対象メンバーの **削除** をクリック  
3) 反映を確認する  

## ユーザー削除（危険操作）
1) `/admin/users` を開く  
2) 対象ユーザーの **削除** を開く  
3) 確認用メールを入力  
4) **完全削除** をクリック  
5) 一覧から消えたことを確認する  

## 失敗時の切り分け

### 権限不足
- 管理画面へアクセスできない場合  
  - `system_admins` にユーザーが登録されているか確認

### Supabase未設定
- 「Supabaseが未設定のため操作できません」と表示される  
  - `.env.local` に `SUPABASE_SERVICE_ROLE_KEY` を追加
  - URL/キーの整合性を確認

### 招待メールが届かない
- SMTP設定が未完了の可能性  
  - 仮パスワード方式で作成して共有する

### メンバー追加で「対象ユーザーが見つかりません」
- ユーザーが作成済みか確認  
- メールアドレスの入力ミスがないか確認
