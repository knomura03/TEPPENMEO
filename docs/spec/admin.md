# 管理アプリ仕様（最小版）

## 目的
- システム全体の状態把握と安全運用を支援する
- プロバイダ設定/監査ログ/診断情報を一元管理する

## 主要画面
- 管理概要: `/admin`
- プロバイダ管理: `/admin/providers`
- 監査ログ: `/admin/audit-logs`
- 診断: `/admin/diagnostics`
- ユーザー管理: `/admin/users`
- 組織一覧: `/admin/organizations`
- 組織メンバー管理: `/admin/organizations/[id]`

## 機能要件

### プロバイダ管理
- 有効/無効、モック/スタブ/有効の状態表示
- 必要な環境変数の有無を案内

### 監査ログ
- 接続/切断/再認可要求などの操作履歴を表示
- 操作主体・対象・時刻を可視化

### 診断
- 必須環境変数の設定有無（値は非表示）
- Supabase接続の簡易判定
- PROVIDER_MOCK_MODE の状態
- Google接続状態（接続済み/未接続/再認可）
- 次にやることの提示

### ユーザー管理
- ユーザー一覧/検索（メールでフィルタ）
- ユーザー作成（招待メール/招待リンク/仮パスワード方式）
- 招待メール失敗時は招待リンクで継続できる
- 組織への追加（ロール付与）
- ロール変更
- 組織から削除（メンバー解除）
- ユーザー無効化/再有効化（Supabase ban + アプリ側ブロック）
- ユーザー削除（危険操作は2段階確認）
- 無効化ユーザーはアプリにアクセスできない

## 権限要件
- system_admin のみ閲覧/操作可能

## 監査方針
- 変更系操作は必ず記録
- トークン/秘密情報は記録しない

## 受け入れ条件（Acceptance Criteria）
- システム管理者のみがユーザー/組織管理にアクセスできる
- ユーザー作成・招待メール/リンク・仮パスワード発行が実行できる
- 組織への追加/ロール変更/削除が実行できる
- 無効化/再有効化が実行でき、無効化ユーザーはアクセス不可になる
- 危険操作は2段階確認が必須
- すべての操作が監査ログに記録される
